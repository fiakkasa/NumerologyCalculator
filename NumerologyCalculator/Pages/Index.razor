@page "/"
@page "/{*text}"

@inject NavigationManager navigationManager

<PageTitle>Numerology Calculator</PageTitle>

<div class="sticky-md-top z-3 px-3 pt-4 pb-0 bg-white">
    <SearchInput @bind-Text:get="Text"
                 @bind-Text:set="OnTextChange"
                 Loading="Loading"
                 FocusOnLoad="true" />
</div>

<div class="px-3 pb-4 hide-when-empty">
    <DigitAdder Text="@Text"
                Title="Numerical Calculation"
                BusyChanged="v => _digitAdderBusy = v"
                ResultChanged="v => _digitAdderResult = v" />
</div>

<div class="px-3 pb-4 hide-when-empty">
    <LetterAdder Text="@Text"
                 Title="Letter Calculation"
                 BusyChanged="v => _letterAdderBusy = v"
                 ResultChanged="v => _letterAdderResult = v" />
</div>

@if ((_digitAdderResult + _letterAdderResult) is { Length: > 1 } combinedResult)
{
    <div class="px-3 pb-4">
        <DigitAdder Text="@combinedResult"
                    Title="Combined Numerical and Letter Calculation"
                    BusyChanged="v => _combinedAdderBusy = v" />
    </div>
}

@code {
    private bool _digitAdderBusy;
    private string _digitAdderResult = string.Empty;
    private bool _letterAdderBusy;
    private string _letterAdderResult = string.Empty;
    private bool _combinedAdderBusy;

    [Parameter]
    public string? Text { get; set; }

    private bool Loading => _digitAdderBusy || _letterAdderBusy || _combinedAdderBusy;

    private void OnTextChange(string value) => navigationManager.NavigateTo($"./{value}", false, true);
}
